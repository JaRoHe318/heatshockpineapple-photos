---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import PhotoCard from "../../../components/PhotoCard.astro";
import photosData from "../../../data/photos.json";

export async function getStaticPaths() {
  const allPhotos = photosData.photos || [];
  const albumPhotos = allPhotos.filter(p => p.album !== null);
  
  const paths = [];
  const seen = new Set();
  
  albumPhotos.forEach(p => {
    const key = `${p.collection}/${p.album}`;
    if (!seen.has(key)) {
      seen.add(key);
      paths.push({
        params: { collection: p.collection, album: p.album },
        props: { 
          photos: allPhotos.filter(img => img.collection === p.collection && img.album === p.album)
        }
      });
    }
  });
  
  return paths;
}

const { collection, album } = Astro.params;
const { photos } = Astro.props;

const displayTitle = album.charAt(0).toUpperCase() + album.slice(1);
const parentTitle = collection.charAt(0).toUpperCase() + collection.slice(1);

// 1. FIX: Grab the first photo to use as the Social Preview
// We use the thumbnail (.src) or the full (.full) depending on what you prefer.
// Usually, for OG tags, the thumbnail (800px) is actually perfect size.
const coverImage = photos.length > 0 ? photos[0].src : undefined;
---

<BaseLayout 
  title={`${displayTitle} - ${parentTitle}`} 
  image={coverImage}
>
  
  <header class="collection-header">
    <div class="header-content">
      <a href={`/gallery/${collection}`} class="back-link">‚Üê {parentTitle}</a>
      <h1 class="collection-title">{displayTitle}</h1>
      <p class="collection-count">{photos.length} Frames</p>
    </div>
  </header>

  <section class="photo-grid">
    {photos.map((photo) => (
      <PhotoCard photo={photo} />
    ))}
  </section>

</BaseLayout>

<style>
  .collection-header { margin: 2rem 0 3rem 0; border-bottom: 1px solid var(--border); padding-bottom: 2rem; }
  .back-link { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); text-decoration: none; }
  .collection-title { font-family: var(--font-serif); font-size: 3rem; margin: 0.5rem 0; color: var(--text-main); text-transform: capitalize; }
  .collection-count { font-family: var(--font-mono); color: var(--text-muted); }
</style>